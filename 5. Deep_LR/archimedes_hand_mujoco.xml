<mujoco model="Archimedes_Hand_Mobile_Arm">
  <option integrator="RK4" timestep="0.001" iterations="50" solver="Newton" tolerance="1e-10" />
  
  <default>
    <default class="robot">
      <default class="motor">
        <joint damping="0.5"/>
        <position forcerange="-20 20"/>
      </default>
      <default class="visual">
        <geom material="defalut_visual" contype="0" conaffinity="0" group="2" />
      </default>
      <default class="collision">
        <geom material="collision_material" condim="3" contype="1" conaffinity="1" priority="1" group="1" friction="2 0.5 0.5" solref="0.01 1" solimp="0.9 0.95 0.001" />
      </default>
      <default class="screw">
        <joint type="hinge" axis="0 1 0" damping="1.0" />
        <geom type="mesh" material="collision_material" condim="3" contype="1" conaffinity="1" priority="1" group="1" friction="2.5 0.5 0.5" solref="0.01 1" />
      </default>
    </default>
  </default>

  <compiler angle="radian" meshdir="./meshes/" />

  <asset>
    <material name="defalut_visual" rgba="0.75294 0.75294 0.75294 1" />
    <material name="collision_material" rgba="1.0 0.28 0.1 0.5" />
    <material name="chassis_mat" rgba="0.2 0.2 0.2 1" />
    
    <!-- Meshes -->
    <mesh name="base_link_mesh" file="base_link.STL" />
    <mesh name="link1_mesh" file="link1.STL" />
    <mesh name="link2_mesh" file="link2.STL" />
    <mesh name="link3_mesh" file="link3.STL" />
    <mesh name="link4_mesh" file="link4.STL" />
    <mesh name="link5_mesh" file="link5.STL" />
    <mesh name="ee_link_mesh" file="ee_link.STL" />
    
    <!-- New Meshes (Scale fixed: screws are in m, base is in mm) -->
    <mesh name="base_plate_mesh" file="base_plate.stl" scale="0.001 0.001 0.001" />
    <mesh name="screw_left_mesh" file="screw_left.stl" />
    <mesh name="screw_right_mesh" file="screw_right.stl" />

    <texture name="plane" type="2d" builtin="checker" rgb1=".1 .1 .1" rgb2=".9 .9 .9" width="64" height="64" />
    <material name="plane" reflectance="0.3" texture="plane" texrepeat="4 4" texuniform="true"/>
  </asset>

  <worldbody>
    <geom name="floor" pos="0 0 0" size="0 0 .25" type="plane" material="plane" condim="3" />
    <light directional="true" ambient=".3 .3 .3" pos="30 30 30" dir="0 -.5 -1" />

    <!-- Mobile Base -->
    <body name="mobile_base" pos="0 0 0.1">
      <freejoint />
      <geom name="chassis" type="mesh" mesh="base_plate_mesh" material="chassis_mat" />
      
      <!-- Screws: Scale factor was 1000 in script (mm to m), positions adjusted -->
      <!-- FL: Left Handed -->
      <body name="screw_fl" pos="-0.15 0.15 -0.05" quat="0.707 0 0.707 0">
        <joint name="joint_fl" class="screw" />
        <geom mesh="screw_left_mesh" class="collision" />
      </body>
      <!-- FR: Right Handed -->
      <body name="screw_fr" pos="0.15 0.15 -0.05" quat="0.707 0 0.707 0">
        <joint name="joint_fr" class="screw" />
        <geom mesh="screw_right_mesh" class="collision" />
      </body>
      <!-- RL: Right Handed -->
      <body name="screw_rl" pos="-0.15 -0.15 -0.05" quat="0.707 0 0.707 0">
        <joint name="joint_rl" class="screw" />
        <geom mesh="screw_right_mesh" class="collision" />
      </body>
      <!-- RR: Left Handed -->
      <body name="screw_rr" pos="0.15 -0.15 -0.05" quat="0.707 0 0.707 0">
        <joint name="joint_rr" class="screw" />
        <geom mesh="screw_left_mesh" class="collision" />
      </body>

      <!-- Mount the Zero Arm on top -->
      <body name="arm_base" pos="0 0 0.02" childclass="robot">
        <geom name="base_link_visual" type="mesh" mesh="base_link_mesh" class="visual" />
        <body name="link1" pos="0 0 0.166" quat="0.707 0 0 0.707">
          <joint name="joint1" type="hinge" axis="0 0 1" class="motor" />
          <geom name="link1_visual" type="mesh" mesh="link1_mesh" class="visual" />
          <body name="link2" pos="0 0 0" quat="0.5 0.5 -0.5 0.5">
            <joint name="joint2" type="hinge" axis="0 0 1" range="-1.57 1.57" class="motor" />
            <geom name="link2_visual" type="mesh" mesh="link2_mesh" class="visual" />
            <body name="link3" pos="0.2 0 0" quat="0 -0.707 -0.707 0">
              <joint name="joint3" type="hinge" axis="0 0 1" range="0 3.14" class="motor" />
              <geom name="link3_visual" type="mesh" mesh="link3_mesh" class="visual" />
              <!-- Simplified for simulation -->
              <body name="link4" pos="0.05 -0.18 0" quat="0.707 -0.707 0 0">
                <joint name="joint4" type="hinge" axis="0 0 1" class="motor" />
                <geom name="link4_visual" type="mesh" mesh="link4_mesh" class="visual" />
                <body name="link5" pos="0 0 0" quat="0.5 0.5 -0.5 0.5">
                  <joint name="joint5" type="hinge" axis="0 0 1" range="-1.57 0" class="motor" />
                  <geom name="link5_visual" type="mesh" mesh="link5_mesh" class="visual" />
                  <body name="ee_link" pos="0 -0.125 0" quat="0.707 0.707 0 0">
                    <joint name="joint6" type="hinge" axis="0 0 1" class="motor" />
                    <geom name="ee_link_visual" type="mesh" mesh="ee_link_mesh" class="visual" />
                    <site name="ee_site" pos="0 0 0" />
                  </body>
                </body>
              </body>
            </body>
          </body>
        </body>
      </body>
    </body>
  </worldbody>

  <actuator>
    <!-- Arm Actuators -->
    <motor name="arm_j1" joint="joint1" gear="1" />
    <motor name="arm_j2" joint="joint2" gear="1" />
    <motor name="arm_j3" joint="joint3" gear="1" />
    <motor name="arm_j4" joint="joint4" gear="1" />
    <motor name="arm_j5" joint="joint5" gear="1" />
    <motor name="arm_j6" joint="joint6" gear="1" />
    <!-- Mobile Base Actuators -->
    <motor name="screw_fl_ctrl" joint="joint_fl" gear="5" />
    <motor name="screw_fr_ctrl" joint="joint_fr" gear="5" />
    <motor name="screw_rl_ctrl" joint="joint_rl" gear="5" />
    <motor name="screw_rr_ctrl" joint="joint_rr" gear="5" />
  </actuator>
</mujoco>
